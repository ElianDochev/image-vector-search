services:
  app:
    build: .
    environment:
      APP_DATA_DIR: ${APP_DATA_DIR:-/app/static}
      STREAMLIT_SERVER_PORT: ${STREAMLIT_SERVER_PORT:-8501}
      LANCEDB_DIR: ${LANCEDB_DIR:-/app/lancedb}
    ports:
      - "8501:8501"
    volumes:
      - ./data:/app/data
      - ./static:/app/static
      - ./lancedb:/app/lancedb

  ingest:
    build: .
    profiles: ["ingest"]
    environment:
      APP_DATA_DIR: ${APP_DATA_DIR:-/app/static}
      LANCEDB_DIR: ${LANCEDB_DIR:-/app/lancedb}
    volumes:
      - ./data:/app/data
      - ./static:/app/static
      - ./lancedb:/app/lancedb
    command: ["python", "scripts/get_embeddings.py"]
